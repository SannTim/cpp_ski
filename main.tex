\documentclass[openany, twoside, a4paper, 12pt]{extbook}

\usepackage[utf8]{inputenc}
\usepackage{rotating}
\usepackage[russian]{babel}
\usepackage{amsfonts} 
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{graphicx} 
\usepackage{subfig}
\usepackage{color}
\usepackage{svg}
\usepackage{epstopdf}
\usepackage[unicode]{hyperref}
\usepackage[nottoc]{tocbibind} 
\usepackage{verbatim}
\usepackage{listings}
\usepackage{indentfirst}
\usepackage{commath}
\usepackage[colorinlistoftodos, prependcaption]{todonotes}
\usepackage{multirow}
\usepackage{algorithmic}
\usepackage{algorithm}

\author{Санников Тимофей Владимирович}
\title{Исследование времени работы широковещательного алгоритма для прохождения критических секций.}

\begin{document}
	\maketitle

	\section*{Формулировка задачи}
	Все 64 процесса, находящихся на разных ЭВМ сети,
	одновременно выдали запрос на вход в критическую секцию.
	Реализовать программу,
	использующую широковещательный маркерный алгоритм для прохождения всеми процессами критических секций.
	
	\begin{algorithm}
		\caption{Критическая секция}
		\begin{algorithmic}[1]
		    \STATE Проверка наличия файла "critical.txt"
			\IF {файл "critical.txt" существует}
		        \STATE Сообщение об ошибке
		        \STATE Завершение работы программы
		    \ELSE
		        \STATE Создание файла "critical.txt"
		        \STATE Sleep(случайное время)
		        \STATE Уничтожение файла "critical.txt"
		    \ENDIF
		\end{algorithmic}
	\end{algorithm}

	Для межпроцессорных взаимодействий использовать средства MPI.\@
	Получить временную оценку работы алгоритма.
	Оценить сколько времени потребуется для прохождения всеми критических секций,
	если маркером владеет нулевой процесс.
	Время старта равно 100, время передачи байта равно 1 ($ Ts=100 $, $ Tb=1 $).
	Процессорные операции, включая чтение из памяти и запись в память,
	считаются бесконечно быстрыми.

	\section*{Программная реализация}
	Для решения данной задачи была реализована программа на языке cpp, соответствующая
	широковещательному алгоритму прохождения критической секции.
	\subsection*{Описание широковещательного алгоритма}
	\begin{itemize}
	
		\item{\textbf{Предоставление доступа.}\\}
			Если маркер у нулевого процесса, он может разрешить процессу $ i $ войти.
			Если нулевой процесс решает, что процесс $ i $ может войти в критическую секцию,
			он передает маркер процессу $ i $.
	
		\item{\textbf{Вход в критическую секцию.}\\}
			Процесс $ i $, получив маркер, входит в критическую секцию и выполняет необходимые операции.

		\item{\textbf{Выход из критической секции.}\\}
			После завершения работы в критической секции процесс $ i $ выходит из нее
			и передает маркер обратно нулевому процессу 
	
		\item{\textbf{Продолжение работы.}\\}
			Нулевой процесс продолжает контролировать доступ к критической секции,
			принимая запросы от других процессов и управляя передачей маркера.
	\end{itemize}
	\subsection*{Описание программной реализации}
	Из-за равнозначности каждого процесса, претендующего на выполнение критической секции,
	очередность случайная и не зависит от номера процесса. Для более точного понимания 
	реализации был написан псевдокод~\ref{alg:all}.
	
	Вычисление времени ожидания каждого процесса:
	
	\begin{equation}
		\label{eq:sleep}
		\text{sleep\_time} = \text{rand}() \mod \text{TIME\_SLEEP\_MAX} + 1
	\end{equation}

	Где TIME\_SLEEP\_MAX было равно 3, значит каждый процесс ждал от 1 до 3-х секунд.

	\begin{algorithm}
		\caption{Алгоритм критической секции MPI}
		\label{alg:all}
		\begin{algorithmic}[1]
			\STATE Определение rank и size
			\STATE Установка начального значения генератора случайных чисел на основе rank
			\IF{rank == 0}
			    \STATE Инициализация remaining\_processes как массив от 1 до size-1
			    \WHILE{remaining\_processes не пустой}
			        \STATE random\_index $\gets$ случайный индекс от 0 до размера remaining\_processes - 1
			        \STATE next\_process $\gets$ remaining\_processes[random\_index]
			        
			        \STATE Вывести оставшиеся процессы
			        \STATE Вывести "Процесс 0 отправляет маркер процессу next\_process"
			        
			        \STATE Отправить next\_process через MPI\_Bcast
			        \STATE Ожидать сообщения об освобождении критической секции от next\_process
			        \STATE Удалить next\_process из remaining\_processes
			    \ENDWHILE
			\ELSE
			    \WHILE{истина}
			        \STATE received\_marker $\gets$ MPI\_Bcast
			        \IF{received\_marker == rank}
			            \STATE Войти в критическую секцию
			            \STATE Отправить сообщение процессу 0 об освобождении критической секции через MPI\_Send
			            \STATE Выйти из цикла
			        \ENDIF
			    \ENDWHILE
			\ENDIF		
		\end{algorithmic}
	\end{algorithm}
	
	\section*{Оценочное время прохождения критической секции}
		Для оценки времени работы алгоритма, нужно учитывать следующее:
		\begin{itemize}
			\item{\textbf{Время старта (Ts):}}\\ 100 единиц;
			\item{\textbf{Время передачи байта (Tb):}}\\ 1 единица;
			\item{\textbf{Время выполнения критической секции:}}\\
			Это будет зависеть от времени, в течение которого процесс находится в критической секции,
			которое мы будем считать как Tcs,
			и оно может варьироваться в зависимости от случайного времени,
			указанного в коде.
		\end{itemize}

		Время передачи маркера (Tb): Для передачи маркера от процесса 0 к процессу 
		$ i $ потребуется $ Tm = Tb = 1 $.
		
		Время критической секции (Tcs): Пусть Tcs - это среднее время,
		в течение которого процесс находится в критической секции.

		Так как Tcs у нас варьируется от 1 до 3 секунд (из-за выражения~\ref{eq:sleep}),
		можно рассмотреть его как $ Tcs = (1 + 2 + 3) / 3 = 2 $ или 200000 миллисекунд.
		
		Время передачи сообщения о завершении использования критической секции:
		$Tk = Tb = 1$.

		Количество процессов (N): Общее количество процессов в системе. $N = 64$
		
		Общее время для прохождения всех критических секций можно выразить следующим образом:
		\begin{equation}
			\label{eq:prefinale}
			T_{общее} = Ts + N \cdot (Tm + Tcs + Tk)
		\end{equation}
		\begin{equation}
			\label{eq:finale}
			T_{общее} = Ts + N \cdot (Tb \cdot 2 + Tcs)
		\end{equation}
		Tcs — среднее время выполнения критической секции.

		Теперь подставим значения в формулу~\ref{eq:finale}:
		\begin{equation}
			T_{общее} = 100 + 64 \cdot (1 \cdot 2 + 200000) = 12800228
		\end{equation}

		Таким образом, общее время,
		необходимое для прохождения всеми процессами критических секций,
		составляет 12800228 единицу времени.
	\section*{Итоги}
		В ходе проведенного исследования была написана программа, имитационно моделирующая
		широковещательный алгоритм прохождения критической секции, выведена формула для вычисления 
		времени работы данного алгоритма, подставлены значения условия в формулу.
\end{document}

